## Đây là Docs tự research:

## Sử dụng react router kết hợp với react query ?

- Khi sử dụng `React Router` kết hợp với `React Query`, chúng ta có thể tận dụng các tính năng của cả hai thư viện để xây dựng ứng dụng web đáng tin cậy với phân trang và quản lý dữ liệu hiệu quả.

- Dưới đây là một ví dụ cơ bản về cách sử dụng `React Router` và `React Query` cùng nhau:

1. Cài đặt `React Router` và `React Query`:

```bash
npm install react-router-dom react-query
```

- Dòng code này được sử dụng để cài đặt hai thư viện `React Router` và `React Query` thông qua npm (Node Package Manager).

  - `npm` là một công cụ quản lý gói cho Node.js và npm Registry là một kho lưu trữ trực tuyến chứa các gói phần mềm JavaScript mà bạn có thể tải xuống và sử dụng trong dự án của mình.
  - `install` là một lệnh trong npm để cài đặt các gói phần mềm. Khi chạy lệnh install, npm sẽ tải xuống và cài đặt các gói được liệt kê trong dòng lệnh vào dự án của bạn.
  - `react-router-dom` là một thư viện hỗ trợ định tuyến (`routing`) trong React. Nó cung cấp các thành phần (`component`) và API để bạn có thể xác định các `route` và hiển thị các component tương ứng với từng `route`.
  - `react-query` là một thư viện quản lý trạng thái và truy vấn dữ liệu trong React. Nó cung cấp các hooks và API để bạn có thể thực hiện các truy vấn dữ liệu, lưu trữ kết quả và quản lý cache một cách dễ dàng.

- Khi chạy dòng lệnh trên, npm sẽ tìm kiếm và tải về các gói `react-router-dom` và `react-query` từ npm Registry, sau đó cài đặt chúng vào thư mục node_modules trong dự án của bạn. Sau khi quá trình cài đặt hoàn tất, bạn có thể sử dụng các thành phần và API của hai thư viện này trong ứng dụng React của mình.

2. Tạo các components và định nghĩa các route trong ứng dụng của bạn, ví dụ:

```jsx
import { BrowserRouter as Router, Switch, Route } from 'react-router-dom'
import { QueryClient, QueryClientProvider } from 'react-query'
import Home from './components/Home'
import PostList from './components/PostList'
import PostDetails from './components/PostDetails'

const queryClient = new QueryClient()

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <Router>
        <Switch>
          <Route exact path='/' component={Home} />
          <Route exact path='/posts' component={PostList} />
          <Route path='/posts/:id' component={PostDetails} />
        </Switch>
      </Router>
    </QueryClientProvider>
  )
}

export default App
```

- Đoạn code trên mô tả cách sử dụng `React Router` và `React Query` trong ứng dụng React. Dưới đây là giải thích từng phần của mã nguồn:

- `import { BrowserRouter as Router, Switch, Route } from 'react-router-dom':` Đây là cách import các thành phần từ thư viện `React Router`. `BrowserRouter` được đặt tên lại thành `Router` để sử dụng trong mã nguồn.

- `import { QueryClient, QueryClientProvider } from 'react-query':` Đây là cách import các thành phần từ thư viện `React Query`. `QueryClient` là một đối tượng quản lý trạng thái và cache của `React Query`, và `QueryClientProvider` là một thành phần cung cấp `QueryClient` cho các thành phần con trong ứng dụng.

- `const queryClient = new QueryClient():` Đây là khởi tạo một instance của `QueryClient`, một đối tượng quản lý trạng thái và cache của `React Query`. Instance này sẽ được sử dụng bởi `QueryClientProvider` để cung cấp cho các thành phần con trong ứng dụng.

- Trong hàm `App()`, chúng ta sử dụng `QueryClientProvider` để bao bọc ứng dụng và cung cấp `queryClient` cho các thành phần con. Điều này cho phép các thành phần con sử dụng `React Query` để thực hiện các truy vấn dữ liệu và quản lý cache.

- Chúng ta sử dụng `Router` để bao bọc các thành phần của ứng dụng và định tuyến giữa các trang. `Switch` là một thành phần của `React Router` dùng để chọn ra chỉ một `Route` phù hợp với URL hiện tại.

- Chúng ta định nghĩa các `Route` để xác định các URL và thành phần tương ứng để hiển thị. Trong ví dụ này, chúng ta có ba `Route`:

  - `exact path='/'` cho trang chủ (component `Home`).
  - `exact path='/posts'` cho danh sách bài viết (component `PostList`).
  - `path='/posts/:id'` cho chi tiết bài viết (component `PostDetails`), trong đó `:id` là một tham số động để xác định ID của bài viết.

- Cuối cùng, chúng ta xuất `App` để sử dụng trong ứng dụng chính.

- Với cấu hình này, `React Router` sẽ xác định các URL và hiển thị các thành phần tương ứng trong ứng dụng. `React Query` sẽ cung cấp khả năng thực hiện truy vấn dữ liệu và quản lý cache cho các thành phần con.

3. Trong các components của bạn, sử dụng các hooks của `React Query` để thực hiện các truy vấn dữ liệu và quản lý state của chúng, ví dụ:

```jsx
import { useQuery } from 'react-query'
import { useParams } from 'react-router-dom'

const fetchPost = async (postId) => {
  const response = await fetch(`api/posts/${postId}`)
  const data = await response.json()
  return data
}

function PostDetails() {
  const { id } = useParams()

  const { data, isLoading, isError, error } = useQuery(['post', id], () => fetchPost(id))

  if (isLoading) {
    return <div>Loading...</div>
  }

  if (isError) {
    return <div>Error: {error.message}</div>
  }

  return (
    <div>
      <h1>Post Details</h1>
      <p>ID: {data.id}</p>
      <p>Title: {data.title}</p>
      <p>Content: {data.content}</p>
    </div>
  )
}

export default PostDetails
```

- Đoạn mã trên mô tả một trang chi tiết bài viết trong ứng dụng sử dụng `React Query` và `React Router`.

  - `import { useQuery } from 'react-query'` và `import { useParams } from 'react-router-dom'`: Đây là cách import `useQuery` từ `React Query` để thực hiện truy vấn dữ liệu và `useParams` từ `React Router` để truy cập vào các tham số động trong URL.

  - `const fetchPost = async (postId) => { ... }`: Đây là hàm `fetchPost` để lấy dữ liệu của một bài viết từ API. Nó sử dụng `postId` làm tham số để xác định bài viết cần lấy. Hàm này sử dụng `fetch` để gửi yêu cầu GET đến API và trả về dữ liệu bài viết dưới dạng JSON. Dòng này sử dụng phương thức `json()` của đối tượng `response` để chuyển đổi dữ liệu trả về thành đối tượng (object) JavaScript. Hàm này trả về một Promise, vì vậy chúng ta sử dụng từ khóa await để đợi việc chuyển đổi dữ liệu thành công.

  - Trong component `PostDetails`, chúng ta sử dụng `useParams` để lấy tham số `id` từ URL. Tham số này xác định ID của bài viết được yêu cầu.

  - Chúng ta sử dụng `useQuery` để thực hiện truy vấn dữ liệu của bài viết. Chúng ta truyền vào một mảng `['post', id]` làm `queryKey`, trong đó `'post'` là một nhãn định danh cho truy vấn và `id` là ID của bài viết để xác định truy vấn duy nhất. Đối số thứ hai của `useQuery` là một hàm callback chứa logic để lấy dữ liệu bài viết từ API bằng cách sử dụng hàm `fetchPost` và truyền `id` làm tham số.

  - `useQuery` sẽ quản lý trạng thái truy vấn và cache dữ liệu. Chúng ta sử dụng các biến `data`, `isLoading`, `isError` và `error` được trả về từ `useQuery` để xử lý trạng thái của truy vấn. Các biến đó có sẵn trong `useQuery`.

  - Trong phần render, chúng ta kiểm tra trạng thái `isLoading` và `isError` để hiển thị thông báo tương ứng. Nếu đang tải dữ liệu, chúng ta hiển thị thông báo "Loading...". Nếu có lỗi, chúng ta hiển thị thông báo lỗi và hiển thị `error.message`, `error` là thông tin lỗi nó được trả về từ hook `useQuery`, nó có sẵn trong `isError`.

  - Nếu trạng thái truy vấn là thành công (`isLoading` và `isError` đều là `false`), chúng ta hiển thị chi tiết bài viết bằng cách truy cập vào `data`. Chúng ta sử dụng các trường `id`, `title` và `content` để hiển thị thông tin bài viết.

- Component `PostDetails` sẽ được sử dụng trong các `Route` để hiển thị trang chi tiết bài viết dựa trên `ID` được truyền qua URL.

✅✅ Tổng lại: Trên đây là một ví dụ cơ bản về việc sử dụng `React Router` kết hợp với `React Query` trong ứng dụng của bạn. Bằng cách sử dụng cả hai thư viện này, bạn có thể quản lý `routing` và truy vấn dữ liệu một cách hiệu quả, mang lại trải nghiệm người dùng tốt hơn và tối ưu hóa việc tải dữ liệu từ server.

## ❌❌ Lưu ý: Trong queryKey: ['post', id]. Cái này cần hiểu kỹ, bắt buộc phải hiểu: 👇👇👇

## ❌❌ Dưới đây là giải thích từng tham số trong queryKey: 👇👇👇

## Hãy giải thích về tham số đầu tiên ['post'] trong `queryKey` rõ ràng hơn ?

- Tham số đầu tiên `['post']` trong `queryKey` đại diện cho loại truy vấn. Nó được sử dụng để định danh loại dữ liệu bạn đang truy vấn.

- Trong trường hợp này, `'post'` là một chuỗi đại diện cho loại dữ liệu `"post"` mà bạn muốn truy vấn. Loại dữ liệu này có thể là bất kỳ chuỗi nào mà bạn tự đặt tên để phù hợp với mô hình dữ liệu của ứng dụng của bạn. Ví dụ: `'user'`, `'comment'`, `'product'`, vv.

- Ví dụ: Nếu ứng dụng của bạn là một blog và bạn muốn truy vấn các bài đăng, bạn có thể sử dụng `['post']` làm `queryKey` để xác định loại truy vấn là `"post"`.

- Mục đích của việc sử dụng loại truy vấn trong `queryKey` là để xác định và phân loại các truy vấn dựa trên loại dữ liệu. Khi bạn có nhiều loại dữ liệu khác nhau trong ứng dụng của mình, việc định danh mỗi loại dữ liệu thông qua `queryKey` giúp React Query quản lý và xử lý các truy vấn một cách chính xác.

## Tham số thứ 2 trong `queryKey` là `id`. Nó có nghĩa là sao. Tôi chưa hiểu lắm ?

- Tham số thứ hai trong `queryKey`, trong trường hợp của bạn là `id`, được sử dụng để xác định một giá trị đặc biệt (ví dụ: ID của bài viết) để truy vấn dữ liệu cụ thể từ server.

- Khi bạn truy vấn dữ liệu từ một nguồn dữ liệu như một API, thông thường bạn cần chỉ định một giá trị duy nhất để xác định dữ liệu cần lấy. Trong trường hợp của bạn là `queryKey: ['post', id]`, `id` đại diện cho giá trị đặc biệt (ví dụ: ID của bài viết) mà bạn muốn truy vấn.

- Với mỗi giá trị `id` khác nhau, bạn có thể truy vấn dữ liệu của các bài viết khác nhau từ server. Khi `id` thay đổi, React Query sẽ tự động gửi yêu cầu mới để lấy dữ liệu tương ứng từ server.

- Ví dụ: Nếu bạn muốn truy vấn dữ liệu bài viết có ID là 1, bạn sẽ sử dụng `queryKey: ['post', 1]`. Điều này cho biết bạn muốn truy vấn dữ liệu bài viết với `ID` là `1` từ server.

- Tóm lại, việc sử dụng `id` là một cách để xác định một giá trị đặc biệt và chỉ định dữ liệu cụ thể bạn muốn truy vấn từ server.

## Khi tôi khai báo như vậy `queryKey: ['post', id]` thì tôi sẽ lấy tất cả các bài viết trong `server` lun hả ?

- Không, khi bạn khai báo `queryKey: ['post', id]`, nghĩa là bạn chỉ định một `queryKey` cụ thể để truy vấn dữ liệu của một bài viết duy nhất từ server. `QueryKey` này gồm hai phần tử: `'post'` và `id`.

- Với cách truy vấn như vậy, React Query sẽ tự động thêm `queryKey` vào bộ nhớ cache để lưu trữ kết quả truy vấn của bài viết đó. Khi bạn thực hiện truy vấn với `queryKey` tương tự trong tương lai, React Query sẽ trước tiên kiểm tra xem liệu dữ liệu đã tồn tại trong cache hay chưa.

- Nếu dữ liệu đã tồn tại trong cache và chưa hết hạn (thời gian hết hạn được xác định bởi `staleTime`), React Query sẽ trả về dữ liệu từ cache mà không gửi yêu cầu mới đến server. Điều này giúp cải thiện hiệu suất ứng dụng.

- Nếu dữ liệu trong cache đã hết hạn hoặc chưa tồn tại trong cache, React Query sẽ tự động gửi yêu cầu mới đến server để lấy dữ liệu của bài viết tương ứng. Sau khi nhận được kết quả từ server, nó sẽ cập nhật cache và trả về kết quả cho bạn sử dụng.

- Vì vậy, với `queryKey: ['post', id]`, bạn chỉ truy vấn dữ liệu của một bài viết duy nhất có `ID` tương ứng từ server, không phải tất cả các bài viết.

## Có nghĩa là các bài viết của tôi đã `render` lên màn hình hết rồi. Và khi tôi khai báo như vậy thì có nghĩa là tôi `click` vào 1 bài viết bất kì trên màn hình, là `id` của bài viết đó được lưu trong `cache`. `queryKey: ['post', id]`, Vậy dòng này có `id` là `id` của mỗi bài viết mà tôi `click` vào đó hả ?

- Đúng, khi bạn khai báo `queryKey: ['post', id]`, trong đó `id` là `id` của bài viết mà bạn đang xem hoặc `click` vào. Điều này cho phép React Query xác định và lưu trữ kết quả truy vấn cho từng bài viết cụ thể trong cache.

- Khi bạn `click` vào một bài viết trên màn hình, bạn có thể truyền `id` của bài viết đó vào `queryKey` để thực hiện truy vấn dữ liệu của bài viết từ server. React Query sẽ sử dụng `queryKey` này để xác định kết quả truy vấn tương ứng trong cache.

- Ví dụ, nếu bạn `click` vào bài viết có `id` là `1`, bạn có thể sử dụng `queryKey: ['post', 1]` để truy vấn dữ liệu của bài viết đó. Khi đó, React Query sẽ kiểm tra cache và trả về kết quả truy vấn của bài viết có `id` là `1` nếu nó đã tồn tại trong cache và chưa hết hạn. Nếu chưa tồn tại hoặc đã hết hạn, React Query sẽ gửi yêu cầu mới đến server để lấy dữ liệu của bài viết và cập nhật cache.

- Việc sử dụng `queryKey` với `id` của bài viết giúp React Query quản lý và lấy dữ liệu tương ứng từ cache và server dễ dàng cho từng bài viết riêng biệt.

## Vậy tóm lại `['post', id]` trong `queryKey`, có nghĩa là khi các bài viết được lưu trong cache thì `'post'` đóng vai trò như `key`, còn `id` đóng vai trò như `value` đúng không ?

- Đúng, bạn đã hiểu đúng. Trong `queryKey: ['post', id]`, `'post'` đóng vai trò như một phần tử `key` và `id` đóng vai trò như một phần tử `value` trong mảng `queryKey`.

- Các mảng `queryKey` được sử dụng trong React Query như một cách để xác định duy nhất một truy vấn dữ liệu. Trong trường hợp này, `'post'` là phần tử `key` và đại diện cho loại dữ liệu bài viết trong truy vấn. `id` là phần tử `value` và đại diện cho giá trị cụ thể của `id` của bài viết mà bạn muốn truy vấn.

- Khi sử dụng `queryKey: ['post', id]`, React Query sẽ sử dụng cả `key` và `value` để xác định truy vấn cụ thể và quản lý kết quả truy vấn cho từng bài viết dựa trên `id` tương ứng.

## Hãy nêu khái niệm useMutation trong react query ?

- Trong React Query, `useMutation` là một hook dùng để thực hiện các yêu cầu thay đổi dữ liệu, chẳng hạn như tạo, cập nhật hoặc xóa (POST, PUT, DELETE) dữ liệu trên server (ngoại trừ GET). Nó cung cấp một cách tiện lợi để thực hiện các thao tác thay đổi dữ liệu và quản lý trạng thái của chúng.

- Khi sử dụng `useMutation`, bạn cần cung cấp một hàm gọi là `mutationFn`, đại diện cho yêu cầu thay đổi dữ liệu (ví dụ: gửi một POST request để tạo mới một bài viết). Khi gọi hàm `mutationFn`, React Query sẽ quản lý quá trình gửi yêu cầu, xử lý kết quả và cung cấp các trạng thái và phương thức hữu ích để tương tác với yêu cầu đó.

- Các trạng thái chính khi sử dụng `useMutation` bao gồm:

- `isLoading:` Đánh dấu xem yêu cầu đang được thực hiện hay không.
- `isError:` Đánh dấu xem yêu cầu có lỗi xảy ra hay không.
- `error:` Thông tin chi tiết về lỗi (nếu có).
- `data:` Dữ liệu trả về từ yêu cầu thành công (nếu có).
- `mutate:` Phương thức để gọi yêu cầu thay đổi dữ liệu.
- `reset:` Phương thức để đặt lại trạng thái yêu cầu.

- `useMutation` cũng cung cấp các callback như `onSuccess` và `onError`, cho phép bạn thực hiện các hành động tuỳ chỉnh sau khi yêu cầu thành công hoặc gặp lỗi.

## Ví dụ cơ bản về useMutation trong react query ?

- Dưới đây là một ví dụ cơ bản về cách sử dụng `useMutation` trong React Query để thực hiện một yêu cầu `POST` để tạo mới một bài viết:

```jsx
import { useMutation } from 'react-query'

const createPost = async (newPost) => {
  const response = await fetch('api/posts', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(newPost)
  })

  if (!response.ok) {
    throw new Error('Failed to create post')
  }

  const data = await response.json()
  return data
}

function CreatePostForm() {
  const mutation = useMutation(createPost)

  const handleSubmit = (event) => {
    event.preventDefault()
    const formData = new FormData(event.target)
    const newPost = Object.fromEntries(formData.entries())
    mutation.mutate(newPost)
  }

  return (
    <form onSubmit={handleSubmit}>
      <input type='text' name='title' placeholder='Title' />
      <textarea name='content' placeholder='Content' />
      <button type='submit' disabled={mutation.isLoading}>
        {mutation.isLoading ? 'Creating...' : 'Create'}
      </button>
      {mutation.isError && <div>Error: {mutation.error.message}</div>}
      {mutation.isSuccess && <div>Post created successfully!</div>}
    </form>
  )
}
```

- Trong ví dụ này, chúng ta sử dụng `useMutation` để tạo một yêu cầu `POST` mới bằng cách cung cấp hàm `createPost` làm đối số cho `useMutation`. Sau đó, chúng ta sử dụng `mutation.mutate` để gọi yêu cầu thay đổi dữ liệu với dữ liệu mới từ `form`.

- `mutation.isLoading` được sử dụng để kiểm tra xem yêu cầu đang được thực hiện hay không để điều chỉnh trạng thái của nút `"Create"`.
- `mutation.isError` và `mutation.error.message` được sử dụng để hiển thị thông báo lỗi nếu có lỗi xảy ra.
- `mutation.isSuccess` được sử dụng để hiển thị thông báo thành công sau khi yêu cầu được thực hiện thành công.

- Đây chỉ là một ví dụ cơ bản về cách sử dụng `useMutation` và có thể được tùy chỉnh và mở rộng theo nhu cầu của ứng dụng.

## Giải thích đoạn code trên:

- Trong đoạn code trên, chúng ta sử dụng `useMutation` từ React Query để thực hiện một yêu cầu `POST` để tạo mới một bài viết.

- Hàm `createPost` là một hàm bất đồng bộ (`async`) được sử dụng để gửi yêu cầu `POST` tới API và trả về dữ liệu sau khi yêu cầu thành công. Nếu yêu cầu gặp lỗi, chúng ta sẽ `throw` một lỗi để xử lý sau này.

- Trong component `CreatePostForm`, chúng ta sử dụng `useMutation(createPost)` để khởi tạo một mutation instance. Mutation instance này cung cấp các thuộc tính và phương thức để theo dõi trạng thái của `mutation`.

- Trong hàm `handleSubmit`, chúng ta sử dụng `mutation.mutate(newPost)` để gọi yêu cầu tạo mới bài viết. `newPost` là đối tượng chứa thông tin bài viết từ `form`.

- Trong form, chúng ta sử dụng `onSubmit` để gọi hàm `handleSubmit` khi form được submit. Trạng thái `mutation.isLoading` được sử dụng để điều khiển trạng thái của nút `"Create"` và trạng thái này được sử dụng để hiển thị thông báo tương ứng (`"Creating..."` hoặc `"Create"`).

- `mutation.isError` được sử dụng để kiểm tra xem yêu cầu có gặp lỗi hay không. Nếu có lỗi, chúng ta hiển thị thông báo lỗi trong `div` có thông báo là Error.

- `mutation.isSuccess` được sử dụng để kiểm tra xem yêu cầu đã thành công hay không. Nếu thành công, chúng ta hiển thị thông báo thành công trong `div` có thông báo là Post created successfully!.

- Đoạn code trên chỉ là một ví dụ cơ bản để giải thích cách sử dụng `useMutation` trong React Query. Bạn có thể tùy chỉnh và mở rộng nó theo nhu cầu của ứng dụng.

## Hãy nêu khái niệm useQuery trong react query ?

- Trong React Query, `useQuery` là một hook được sử dụng để thực hiện yêu cầu lấy dữ liệu từ một nguồn bên ngoài, chẳng hạn như API, và theo dõi trạng thái của yêu cầu.

- Khi sử dụng `useQuery`, bạn cần cung cấp các thông tin cần thiết như `queryKey` và `queryFn`. `queryKey` là một giá trị duy nhất được sử dụng để định danh cho query, xác định loại dữ liệu được yêu cầu. `queryFn` là một hàm mà React Query sẽ gọi để thực hiện yêu cầu lấy dữ liệu.

- Khi yêu cầu được gửi đi, `useQuery` sẽ tự động theo dõi trạng thái của yêu cầu và cung cấp các biến như `data`, `isLoading`, `isError`, `error`, `isFetching`, `refetch` và nhiều biến khác để giúp bạn xử lý và hiển thị dữ liệu và trạng thái tương ứng.

- Một số khái niệm quan trọng liên quan đến `useQuery` trong React Query:

- `data`: Dữ liệu trả về từ yêu cầu lấy dữ liệu. Nó sẽ được cập nhật khi yêu cầu thành công.
- `isLoading`: Xác định xem yêu cầu đang trong quá trình tải hay không.
- `isError`: Xác định xem yêu cầu có gặp lỗi hay không.
- `error`: Thông tin về lỗi nếu yêu cầu gặp lỗi.
- `isFetching`: Xác định xem yêu cầu đang trong quá trình fetch hay không, bao gồm cả khi sử dụng refetch.
- `refetch`: Một hàm dùng để gửi lại yêu cầu lấy dữ liệu.
- `onSuccess`: Một hàm callback được gọi khi yêu cầu thành công.
- `onError`: Một hàm callback được gọi khi yêu cầu gặp lỗi.

- Sử dụng `useQuery`, bạn có thể tạo các query instances để thực hiện các yêu cầu lấy dữ liệu khác nhau trong ứng dụng và quản lý trạng thái của chúng.

## Ví dụ cơ bản về useQuery trong react query ?

- Dưới đây là một ví dụ cơ bản về cách sử dụng `useQuery` trong React Query để lấy danh sách các bài viết từ một API:

```jsx
import { useQuery } from 'react-query'

const fetchPosts = async () => {
  const response = await fetch('api/posts')
  const data = await response.json()
  return data
}

function PostList() {
  const { data, isLoading, isError, error } = useQuery('posts', fetchPosts)

  if (isLoading) {
    return <div>Loading...</div>
  }

  if (isError) {
    return <div>Error: {error.message}</div>
  }

  return (
    <div>
      <h1>Post List</h1>
      <ul>
        {data.map((post) => (
          <li key={post.id}>{post.title}</li>
        ))}
      </ul>
    </div>
  )
}
```

- Trong ví dụ trên, chúng ta sử dụng `useQuery` để thực hiện yêu cầu lấy danh sách các bài viết từ API. Chúng ta cung cấp một `queryKey` (trong trường hợp này là `'posts'`) để định danh cho query và một `queryFn` (trong trường hợp này là hàm `fetchPosts`) để thực hiện yêu cầu.

- Khi yêu cầu được gửi đi, `useQuery` sẽ tự động theo dõi trạng thái của yêu cầu và cung cấp các biến như `data`, `isLoading`, `isError`, `error` để xử lý và hiển thị dữ liệu tương ứng. Trong ví dụ này, chúng ta kiểm tra trạng thái của yêu cầu và hiển thị dữ liệu, thông báo tải dữ liệu hoặc thông báo lỗi tương ứng.

- Với `useQuery`, chúng ta có thể dễ dàng thực hiện các yêu cầu lấy dữ liệu và quản lý trạng thái của chúng trong ứng dụng React một cách dễ dàng và mạnh mẽ.

## Định danh trong query trong queryKey của React Query là sao ?

- Trong ngữ cảnh của React Query, "định danh" (identity) là một cách để xác định một truy vấn dữ liệu một cách duy nhất. Nó được sử dụng để phân biệt các truy vấn khác nhau và quản lý kết quả truy vấn.

- Định danh thường được xác định bằng cách sử dụng một giá trị duy nhất như một khóa (`key`). Trong React Query, `queryKey` có thể được sử dụng để xác định định danh cho một truy vấn. `queryKey` có thể là một mảng (array) chứa các giá trị như tên truy vấn và các tham số đi kèm, hoặc có thể là một giá trị duy nhất đại diện cho truy vấn.

- Khi định danh của một truy vấn thay đổi, React Query sẽ hiểu rằng đó là một truy vấn mới và sẽ thực hiện truy vấn lại từ `server` thay vì sử dụng kết quả từ bộ nhớ `cache`. Điều này đảm bảo rằng bạn nhận được dữ liệu mới nhất từ `server` khi có sự thay đổi trong định danh của truy vấn.

## Mỗi giá trị định danh đó thì nó sẽ gán cho 1 id. Có nghĩa là 1 dữ liệu được gán cho 1 id, có 10 dữ liệu thì sẽ gán cho 10 id hả ?

- Đúng, trong React Query, mỗi giá trị định danh (`queryKey`) sẽ được gán cho một ID duy nhất để xác định truy vấn dữ liệu tương ứng. Khi thực hiện một truy vấn, React Query sẽ sử dụng định danh để xác định xem truy vấn đã được thực hiện trước đó hay chưa.

- Ví dụ, nếu bạn có 10 dữ liệu và muốn lấy thông tin chi tiết về từng dữ liệu, bạn có thể sử dụng `queryKey` với một giá trị duy nhất (ví dụ: `'post'`) và kết hợp nó với ID của từng bài viết để tạo ra một định danh duy nhất cho từng truy vấn. Điều này cho phép React Query quản lý các kết quả truy vấn riêng biệt cho từng bài viết.

- Ví dụ: `['post', 1]`, `['post', 2]`, `['post', 3]`, v.v. là các định danh duy nhất cho các truy vấn lấy thông tin từng bài viết tương ứng.

## Tổng quan về useMutation và useQuery trong react query ?

- `useMutation` và `useQuery` là hai hook quan trọng trong React Query. Dưới đây là tổng quan về cả hai hook:

1. `useMutation`:

- `useMutation` được sử dụng để thực hiện các yêu cầu `thay đổi` dữ liệu như tạo mới, cập nhật hoặc xóa dữ liệu từ server.
- Nó nhận vào một hàm `mutationFn` (hoặc promise) để thực hiện yêu cầu thay đổi dữ liệu.

- `useMutation` cung cấp các biến và phương thức để quản lý trạng thái của yêu cầu, như `isLoading`, `isError`, `error`, `data`, `mutate`, `reset`, và nhiều hơn nữa.

  - `mutate`: Phương thức này dùng để kích hoạt quá trình mutation. Bạn có thể truyền vào dữ liệu cần thay đổi và nó sẽ gửi yêu cầu tới server để thực hiện mutation.
  - `isLoading, isError, isSuccess`: Các trạng thái này xác định trạng thái hiện tại của quá trình mutation (đang tải, có lỗi, thành công).
  - `error`: Nếu có lỗi xảy ra trong quá trình mutation, thông tin lỗi sẽ được lưu trong biến error.
  - `reset`: Phương thức này dùng để đặt lại trạng thái của mutation về trạng thái ban đầu.

- Bằng cách sử dụng `mutate`, chúng ta có thể gửi yêu cầu thay đổi dữ liệu một cách bất đồng bộ và quản lý trạng thái yêu cầu dễ dàng.

2. `useQuery`:

- `useQuery` được sử dụng để thực hiện các yêu cầu `lấy` dữ liệu từ server.
- Nó nhận vào một `queryKey` để định danh cho yêu cầu và một `queryFn` (hoặc promise) để thực hiện yêu cầu lấy dữ liệu.

- `useQuery` cung cấp các biến và phương thức để quản lý trạng thái của yêu cầu, như `isLoading`, `isError`, `error`, `data`, `refetch`, `reset`, và nhiều hơn nữa.

  - `data`: Dữ liệu trả về từ server được lưu trong biến `data`.
  - `isLoading, isError, isSuccess`: Các trạng thái này xác định trạng thái hiện tại của quá trình truy vấn (đang tải, có lỗi, thành công).
  - `error`: Nếu có lỗi xảy ra trong quá trình truy vấn, thông tin lỗi sẽ được lưu trong biến error.
  - `refetch`: Phương thức này dùng để làm mới truy vấn, gửi yêu cầu lên server để lấy dữ liệu mới.
  - `invalidateQueries`: Phương thức này dùng để đánh dấu các truy vấn liên quan là không hợp lệ, yêu cầu truy vấn lại dữ liệu từ server.

- Khi sử dụng `useQuery`, React Query sẽ tự động quản lý bộ nhớ cache và sử dụng dữ liệu đã lưu trữ trong cache nếu có, giúp tối ưu hiệu suất và giảm số lần gửi yêu cầu lặp lại.

- Cả hai hook đều giúp chúng ta quản lý trạng thái yêu cầu dễ dàng và tự động, hỗ trợ tải dữ liệu bất đồng bộ, quản lý cache và cung cấp các phương thức tiện ích để thao tác với dữ liệu. Sử dụng `useMutation` và `useQuery` trong React Query giúp tạo ra trải nghiệm tốt hơn cho việc làm việc với dữ liệu trong ứng dụng React.

## Tóm lại là khi sử dụng `useMutation` là bao gồm POST, PUT, DELETE. Còn khi sử dụng `useQuery` là sử dụng GET ?

- Đúng, khi sử dụng `useMutation` trong React Query, chúng ta thường sử dụng nó để thực hiện các yêu cầu `thay đổi` dữ liệu như tạo mới (POST), cập nhật (PUT/PATCH) và xóa (DELETE). Điều này là do các yêu cầu này thường liên quan đến việc `thay đổi` dữ liệu trên server.

- Trong khi đó, khi sử dụng `useQuery`, chúng ta thường sử dụng nó để thực hiện yêu cầu `lấy` dữ liệu từ server, điển hình là yêu cầu GET. Chúng ta sử dụng `useQuery` để lấy dữ liệu từ server và quản lý trạng thái của yêu cầu, bao gồm trạng thái tải dữ liệu (`isLoading`), trạng thái lỗi (`isError`), dữ liệu đã được lấy (`data`), và nhiều thuộc tính và phương thức khác.

- Tuy nhiên, trong thực tế, không có quy tắc cứng và nhanh chóng rằng `useMutation` chỉ được sử dụng cho POST, PUT và DELETE, và `useQuery` chỉ được sử dụng cho GET. Chúng ta có thể sử dụng cả hai hook để thực hiện các yêu cầu tùy chỉnh và phù hợp với nhu cầu cụ thể của ứng dụng của chúng ta. Mục đích chính của React Query là hỗ trợ việc làm việc với dữ liệu bất đồng bộ và quản lý trạng thái của các yêu cầu dễ dàng và hiệu quả.

## React Toastify là gì ?

- React Toastify là một thư viện React được sử dụng để hiển thị các thông báo (toasts) trong ứng dụng web. Nó cung cấp các thành phần và API đơn giản để tạo ra các thông báo đẹp, linh hoạt và dễ sử dụng.

- Với React Toastify, bạn có thể hiển thị các thông báo tạm thời trong góc màn hình, thông báo lỗi, thông báo thành công, thông báo cảnh báo và nhiều loại thông báo khác. Bạn có thể tùy chỉnh các thông báo theo ý muốn, bao gồm nội dung, kiểu, thời gian tồn tại, hành động, hình ảnh và nhiều thuộc tính khác.

- React Toastify cung cấp một API đơn giản để tạo ra các thông báo bằng cách sử dụng các hàm như `toast.success()`, `toast.error()`, `toast.warning()` và `toast.info()`. Nó cũng cung cấp các hook như `useToast()` để tạo ra các thông báo từ các thành phần React.

- Thư viện này giúp cải thiện trải nghiệm người dùng và tăng tính tương tác trong ứng dụng của bạn bằng cách cung cấp các thông báo hữu ích và hấp dẫn cho người dùng.

## cho ví dụ cơ bản về React Toastify ?

- Để sử dụng React Toastify, bạn cần cài đặt thư viện `react-toastify` và import các thành phần cần thiết. Dưới đây là một ví dụ cơ bản về việc sử dụng React Toastify để hiển thị thông báo thành công:

```jsx
import React from 'react'
import { toast, ToastContainer } from 'react-toastify'
import 'react-toastify/dist/ReactToastify.css'

const ExampleComponent = () => {
  const handleButtonClick = () => {
    toast.success('Thao tác thành công!')
  }

  return (
    <div>
      <button onClick={handleButtonClick}>Hiển thị thông báo</button>
      <ToastContainer />
    </div>
  )
}

export default ExampleComponent
```

- Trong ví dụ trên, chúng ta import thành phần `toast` và `ToastContainer` từ `react-toastify`. Hàm `toast.success()` được sử dụng để hiển thị thông báo thành công khi người dùng nhấp vào nút. `ToastContainer` được đặt trong thành phần để chứa và hiển thị các thông báo.

- Bạn có thể thay đổi kiểu thông báo bằng cách sử dụng các hàm khác như `toast.error()` (thông báo lỗi), `toast.warning()` (thông báo cảnh báo) và `toast.info()` (thông báo thông tin). Bạn cũng có thể tùy chỉnh nội dung và các thuộc tính khác của thông báo theo ý muốn.

- Lưu ý rằng bạn cần import CSS của React Toastify (`react-toastify/dist/ReactToastify.css`) để đảm bảo giao diện của thông báo được hiển thị đúng cách.

- Đây chỉ là một ví dụ đơn giản về cách sử dụng React Toastify. Thư viện này còn rất nhiều tính năng và tùy chọn để bạn khám phá và tùy chỉnh theo nhu cầu của mình.

## Đây là Docs của Được Dev:

TIếp nối video lần trước, lần này chúng ta sẽ thực hiện chức năng Edit và Delete Student bằng React Query nhé.

💓Kiến thức các bạn sẽ được học trong video này:

🎉 Sử dụng react router kết hợp với react query
🎉 useMutation và useQuery
🎉 React Toastify

🕰️Nội dung chính

00:00 - Edit Student
15:50 - Sử dụng React Toastify
18:40 - Xử lý lỗi submit từ server trả về
22:11 - Delete Student
