## Đây là Docs tự research:

## Sử dụng react router kết hợp với react query ?

- Khi sử dụng `React Router` kết hợp với `React Query`, chúng ta có thể tận dụng các tính năng của cả hai thư viện để xây dựng ứng dụng web đáng tin cậy với phân trang và quản lý dữ liệu hiệu quả.

- Dưới đây là một ví dụ cơ bản về cách sử dụng `React Router` và `React Query` cùng nhau:

1. Cài đặt `React Router` và `React Query`:

```bash
npm install react-router-dom react-query
```

- Dòng code này được sử dụng để cài đặt hai thư viện `React Router` và `React Query` thông qua npm (Node Package Manager).

  - `npm` là một công cụ quản lý gói cho Node.js và npm Registry là một kho lưu trữ trực tuyến chứa các gói phần mềm JavaScript mà bạn có thể tải xuống và sử dụng trong dự án của mình.
  - `install` là một lệnh trong npm để cài đặt các gói phần mềm. Khi chạy lệnh install, npm sẽ tải xuống và cài đặt các gói được liệt kê trong dòng lệnh vào dự án của bạn.
  - `react-router-dom` là một thư viện hỗ trợ định tuyến (`routing`) trong React. Nó cung cấp các thành phần (`component`) và API để bạn có thể xác định các `route` và hiển thị các component tương ứng với từng `route`.
  - `react-query` là một thư viện quản lý trạng thái và truy vấn dữ liệu trong React. Nó cung cấp các hooks và API để bạn có thể thực hiện các truy vấn dữ liệu, lưu trữ kết quả và quản lý cache một cách dễ dàng.

- Khi chạy dòng lệnh trên, npm sẽ tìm kiếm và tải về các gói `react-router-dom` và `react-query` từ npm Registry, sau đó cài đặt chúng vào thư mục node_modules trong dự án của bạn. Sau khi quá trình cài đặt hoàn tất, bạn có thể sử dụng các thành phần và API của hai thư viện này trong ứng dụng React của mình.

2. Tạo các components và định nghĩa các route trong ứng dụng của bạn, ví dụ:

```jsx
import { BrowserRouter as Router, Switch, Route } from 'react-router-dom'
import { QueryClient, QueryClientProvider } from 'react-query'
import Home from './components/Home'
import PostList from './components/PostList'
import PostDetails from './components/PostDetails'

const queryClient = new QueryClient()

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <Router>
        <Switch>
          <Route exact path='/' component={Home} />
          <Route exact path='/posts' component={PostList} />
          <Route path='/posts/:id' component={PostDetails} />
        </Switch>
      </Router>
    </QueryClientProvider>
  )
}

export default App
```

- Đoạn code trên mô tả cách sử dụng `React Router` và `React Query` trong ứng dụng React. Dưới đây là giải thích từng phần của mã nguồn:

- `import { BrowserRouter as Router, Switch, Route } from 'react-router-dom':` Đây là cách import các thành phần từ thư viện `React Router`. `BrowserRouter` được đặt tên lại thành `Router` để sử dụng trong mã nguồn.

- `import { QueryClient, QueryClientProvider } from 'react-query':` Đây là cách import các thành phần từ thư viện `React Query`. `QueryClient` là một đối tượng quản lý trạng thái và cache của `React Query`, và `QueryClientProvider` là một thành phần cung cấp `QueryClient` cho các thành phần con trong ứng dụng.

- `const queryClient = new QueryClient():` Đây là khởi tạo một instance của `QueryClient`, một đối tượng quản lý trạng thái và cache của `React Query`. Instance này sẽ được sử dụng bởi `QueryClientProvider` để cung cấp cho các thành phần con trong ứng dụng.

- Trong hàm `App()`, chúng ta sử dụng `QueryClientProvider` để bao bọc ứng dụng và cung cấp `queryClient` cho các thành phần con. Điều này cho phép các thành phần con sử dụng `React Query` để thực hiện các truy vấn dữ liệu và quản lý cache.

- Chúng ta sử dụng `Router` để bao bọc các thành phần của ứng dụng và định tuyến giữa các trang. `Switch` là một thành phần của `React Router` dùng để chọn ra chỉ một `Route` phù hợp với URL hiện tại.

- Chúng ta định nghĩa các `Route` để xác định các URL và thành phần tương ứng để hiển thị. Trong ví dụ này, chúng ta có ba `Route`:

  - `exact path='/'` cho trang chủ (component `Home`).
  - `exact path='/posts'` cho danh sách bài viết (component `PostList`).
  - `path='/posts/:id'` cho chi tiết bài viết (component `PostDetails`), trong đó `:id` là một tham số động để xác định ID của bài viết.

- Cuối cùng, chúng ta xuất `App` để sử dụng trong ứng dụng chính.

- Với cấu hình này, `React Router` sẽ xác định các URL và hiển thị các thành phần tương ứng trong ứng dụng. `React Query` sẽ cung cấp khả năng thực hiện truy vấn dữ liệu và quản lý cache cho các thành phần con.

3. Trong các components của bạn, sử dụng các hooks của `React Query` để thực hiện các truy vấn dữ liệu và quản lý state của chúng, ví dụ:

```jsx
import { useQuery } from 'react-query'
import { useParams } from 'react-router-dom'

const fetchPost = async (postId) => {
  const response = await fetch(`api/posts/${postId}`)
  const data = await response.json()
  return data
}

function PostDetails() {
  const { id } = useParams()

  const { data, isLoading, isError, error } = useQuery(['post', id], () => fetchPost(id))

  if (isLoading) {
    return <div>Loading...</div>
  }

  if (isError) {
    return <div>Error: {error.message}</div>
  }

  return (
    <div>
      <h1>Post Details</h1>
      <p>ID: {data.id}</p>
      <p>Title: {data.title}</p>
      <p>Content: {data.content}</p>
    </div>
  )
}

export default PostDetails
```

- Đoạn mã trên mô tả một trang chi tiết bài viết trong ứng dụng sử dụng `React Query` và `React Router`.

  - `import { useQuery } from 'react-query'` và `import { useParams } from 'react-router-dom'`: Đây là cách import `useQuery` từ `React Query` để thực hiện truy vấn dữ liệu và `useParams` từ `React Router` để truy cập vào các tham số động trong URL.

  - `const fetchPost = async (postId) => { ... }`: Đây là hàm `fetchPost` để lấy dữ liệu của một bài viết từ API. Nó sử dụng `postId` làm tham số để xác định bài viết cần lấy. Hàm này sử dụng `fetch` để gửi yêu cầu GET đến API và trả về dữ liệu bài viết dưới dạng JSON. Dòng này sử dụng phương thức `json()` của đối tượng `response` để chuyển đổi dữ liệu trả về thành đối tượng (object) JavaScript. Hàm này trả về một Promise, vì vậy chúng ta sử dụng từ khóa await để đợi việc chuyển đổi dữ liệu thành công.

  - Trong component `PostDetails`, chúng ta sử dụng `useParams` để lấy tham số `id` từ URL. Tham số này xác định ID của bài viết được yêu cầu.

  - Chúng ta sử dụng `useQuery` để thực hiện truy vấn dữ liệu của bài viết. Chúng ta truyền vào một mảng `['post', id]` làm `queryKey`, trong đó `'post'` là một nhãn định danh cho truy vấn và `id` là ID của bài viết để xác định truy vấn duy nhất. Đối số thứ hai của `useQuery` là một hàm callback chứa logic để lấy dữ liệu bài viết từ API bằng cách sử dụng hàm `fetchPost` và truyền `id` làm tham số.

  - `useQuery` sẽ quản lý trạng thái truy vấn và cache dữ liệu. Chúng ta sử dụng các biến `data`, `isLoading`, `isError` và `error` được trả về từ `useQuery` để xử lý trạng thái của truy vấn. Các biến đó có sẵn trong `useQuery`.

  - Trong phần render, chúng ta kiểm tra trạng thái `isLoading` và `isError` để hiển thị thông báo tương ứng. Nếu đang tải dữ liệu, chúng ta hiển thị thông báo "Loading...". Nếu có lỗi, chúng ta hiển thị thông báo lỗi và hiển thị `error.message`, `error` là thông tin lỗi nó được trả về từ hook `useQuery`, nó có sẵn trong `isError`.

  - Nếu trạng thái truy vấn là thành công (`isLoading` và `isError` đều là `false`), chúng ta hiển thị chi tiết bài viết bằng cách truy cập vào `data`. Chúng ta sử dụng các trường `id`, `title` và `content` để hiển thị thông tin bài viết.

- Component `PostDetails` sẽ được sử dụng trong các `Route` để hiển thị trang chi tiết bài viết dựa trên `ID` được truyền qua URL.

✅✅ Tổng lại: Trên đây là một ví dụ cơ bản về việc sử dụng `React Router` kết hợp với `React Query` trong ứng dụng của bạn. Bằng cách sử dụng cả hai thư viện này, bạn có thể quản lý `routing` và truy vấn dữ liệu một cách hiệu quả, mang lại trải nghiệm người dùng tốt hơn và tối ưu hóa việc tải dữ liệu từ server.

## ❌❌ Lưu ý: Trong queryKey: ['post', id]. Cái này cần hiểu kỹ, bắt buộc phải hiểu: 👇👇👇

## ❌❌ Dưới đây là giải thích từng tham số trong queryKey: 👇👇👇

## Hãy giải thích về tham số đầu tiên ['post'] trong `queryKey` rõ ràng hơn ?

- Tham số đầu tiên `['post']` trong `queryKey` đại diện cho loại truy vấn. Nó được sử dụng để định danh loại dữ liệu bạn đang truy vấn.

- Trong trường hợp này, `'post'` là một chuỗi đại diện cho loại dữ liệu `"post"` mà bạn muốn truy vấn. Loại dữ liệu này có thể là bất kỳ chuỗi nào mà bạn tự đặt tên để phù hợp với mô hình dữ liệu của ứng dụng của bạn. Ví dụ: `'user'`, `'comment'`, `'product'`, vv.

- Ví dụ: Nếu ứng dụng của bạn là một blog và bạn muốn truy vấn các bài đăng, bạn có thể sử dụng `['post']` làm `queryKey` để xác định loại truy vấn là `"post"`.

- Mục đích của việc sử dụng loại truy vấn trong `queryKey` là để xác định và phân loại các truy vấn dựa trên loại dữ liệu. Khi bạn có nhiều loại dữ liệu khác nhau trong ứng dụng của mình, việc định danh mỗi loại dữ liệu thông qua `queryKey` giúp React Query quản lý và xử lý các truy vấn một cách chính xác.

## Tham số thứ 2 trong `queryKey` là `id`. Nó có nghĩa là sao. Tôi chưa hiểu lắm ?

- Tham số thứ hai trong `queryKey`, trong trường hợp của bạn là `id`, được sử dụng để xác định một giá trị đặc biệt (ví dụ: ID của bài viết) để truy vấn dữ liệu cụ thể từ server.

- Khi bạn truy vấn dữ liệu từ một nguồn dữ liệu như một API, thông thường bạn cần chỉ định một giá trị duy nhất để xác định dữ liệu cần lấy. Trong trường hợp của bạn là `queryKey: ['post', id]`, `id` đại diện cho giá trị đặc biệt (ví dụ: ID của bài viết) mà bạn muốn truy vấn.

- Với mỗi giá trị `id` khác nhau, bạn có thể truy vấn dữ liệu của các bài viết khác nhau từ server. Khi `id` thay đổi, React Query sẽ tự động gửi yêu cầu mới để lấy dữ liệu tương ứng từ server.

- Ví dụ: Nếu bạn muốn truy vấn dữ liệu bài viết có ID là 1, bạn sẽ sử dụng `queryKey: ['post', 1]`. Điều này cho biết bạn muốn truy vấn dữ liệu bài viết với `ID` là `1` từ server.

- Tóm lại, việc sử dụng `id` là một cách để xác định một giá trị đặc biệt và chỉ định dữ liệu cụ thể bạn muốn truy vấn từ server.

## Khi tôi khai báo như vậy `queryKey: ['post', id]` thì tôi sẽ lấy tất cả các bài viết trong `server` lun hả ?

- Không, khi bạn khai báo `queryKey: ['post', id]`, nghĩa là bạn chỉ định một `queryKey` cụ thể để truy vấn dữ liệu của một bài viết duy nhất từ server. `QueryKey` này gồm hai phần tử: `'post'` và `id`.

- Với cách truy vấn như vậy, React Query sẽ tự động thêm `queryKey` vào bộ nhớ cache để lưu trữ kết quả truy vấn của bài viết đó. Khi bạn thực hiện truy vấn với `queryKey` tương tự trong tương lai, React Query sẽ trước tiên kiểm tra xem liệu dữ liệu đã tồn tại trong cache hay chưa.

- Nếu dữ liệu đã tồn tại trong cache và chưa hết hạn (thời gian hết hạn được xác định bởi `staleTime`), React Query sẽ trả về dữ liệu từ cache mà không gửi yêu cầu mới đến server. Điều này giúp cải thiện hiệu suất ứng dụng.

- Nếu dữ liệu trong cache đã hết hạn hoặc chưa tồn tại trong cache, React Query sẽ tự động gửi yêu cầu mới đến server để lấy dữ liệu của bài viết tương ứng. Sau khi nhận được kết quả từ server, nó sẽ cập nhật cache và trả về kết quả cho bạn sử dụng.

- Vì vậy, với `queryKey: ['post', id]`, bạn chỉ truy vấn dữ liệu của một bài viết duy nhất có `ID` tương ứng từ server, không phải tất cả các bài viết.

## Có nghĩa là các bài viết của tôi đã `render` lên màn hình hết rồi. Và khi tôi khai báo như vậy thì có nghĩa là tôi `click` vào 1 bài viết bất kì trên màn hình, là `id` của bài viết đó được lưu trong `cache`. `queryKey: ['post', id]`, Vậy dòng này có `id` là `id` của mỗi bài viết mà tôi `click` vào đó hả ?

- Đúng, khi bạn khai báo `queryKey: ['post', id]`, trong đó `id` là `id` của bài viết mà bạn đang xem hoặc `click` vào. Điều này cho phép React Query xác định và lưu trữ kết quả truy vấn cho từng bài viết cụ thể trong cache.

- Khi bạn `click` vào một bài viết trên màn hình, bạn có thể truyền `id` của bài viết đó vào `queryKey` để thực hiện truy vấn dữ liệu của bài viết từ server. React Query sẽ sử dụng `queryKey` này để xác định kết quả truy vấn tương ứng trong cache.

- Ví dụ, nếu bạn `click` vào bài viết có `id` là `1`, bạn có thể sử dụng `queryKey: ['post', 1]` để truy vấn dữ liệu của bài viết đó. Khi đó, React Query sẽ kiểm tra cache và trả về kết quả truy vấn của bài viết có `id` là `1` nếu nó đã tồn tại trong cache và chưa hết hạn. Nếu chưa tồn tại hoặc đã hết hạn, React Query sẽ gửi yêu cầu mới đến server để lấy dữ liệu của bài viết và cập nhật cache.

- Việc sử dụng `queryKey` với `id` của bài viết giúp React Query quản lý và lấy dữ liệu tương ứng từ cache và server dễ dàng cho từng bài viết riêng biệt.

## Vậy tóm lại `['post', id]` trong `queryKey`, có nghĩa là khi các bài viết được lưu trong cache thì `'post'` đóng vai trò như `key`, còn `id` đóng vai trò như `value` đúng không ?

- Đúng, bạn đã hiểu đúng. Trong `queryKey: ['post', id]`, `'post'` đóng vai trò như một phần tử `key` và `id` đóng vai trò như một phần tử `value` trong mảng `queryKey`.

- Các mảng `queryKey` được sử dụng trong React Query như một cách để xác định duy nhất một truy vấn dữ liệu. Trong trường hợp này, `'post'` là phần tử `key` và đại diện cho loại dữ liệu bài viết trong truy vấn. `id` là phần tử `value` và đại diện cho giá trị cụ thể của `id` của bài viết mà bạn muốn truy vấn.

- Khi sử dụng `queryKey: ['post', id]`, React Query sẽ sử dụng cả `key` và `value` để xác định truy vấn cụ thể và quản lý kết quả truy vấn cho từng bài viết dựa trên `id` tương ứng.

## Hãy nêu khái niệm useMutation trong react query ?

## Ví dụ về useMutation trong react query ?

## Ví dụ về useQuery trong react query ?

## Hãy nêu khái niệm useQuery trong react query ?

## Tổng quan về useMutation và useQuery trong react query ?

## React Toastify

## Đây là Docs của Được Dev:

TIếp nối video lần trước, lần này chúng ta sẽ thực hiện chức năng Edit và Delete Student bằng React Query nhé.

💓Kiến thức các bạn sẽ được học trong video này:

🎉 Sử dụng react router kết hợp với react query
🎉 useMutation và useQuery
🎉 React Toastify

🕰️Nội dung chính

00:00 - Edit Student
15:50 - Sử dụng React Toastify
18:40 - Xử lý lỗi submit từ server trả về
22:11 - Delete Student
