## Đây là Docs tự research:

- ❓ Đây là câu hỏi trong bài này:

- ❓ Câu hỏi: Anh ơi, em thấy trong `useQuery()` đã có sẵn hàm `refetch()`, em cũng hay dùng hàm này mỗi khi cần refetch data sau khi `mutate`. Vậy hàm `refetch()` này khác thế nào với 2 cái `queryClient.setQueyData()` và `queryClient.invalidateQueries()` là gì ấy anh ?

- ✅ Trả lời: `refetch` => Gọi 1 cái query instance trong component. `invalidateQueries` => Gọi lại 1 hoặc nhiều query, có thể dùng cho các component khác cũng được. `setQueryData` => Cập nhật data mới (không fetch lại API)

## Ôn lại bài cũ: 💥💥💥

## Trong react query trong đó có queryKey. Trong queryKey có 2 tham số, 2 tham số đó là gì ?

- Trong React Query, `queryKey` là một mảng gồm các tham số để xác định một truy vấn dữ liệu cụ thể. Mỗi phần tử trong mảng `queryKey` đại diện cho một phần quan trọng trong việc xác định truy vấn.

- Thường thì `queryKey` được định nghĩa với cấu trúc `[type, ...params]`, trong đó:

  - `type`: Là một chuỗi (string) đại diện cho loại dữ liệu bạn muốn truy vấn, ví dụ như "user", "todos", "posts",...
  - `params`: Là các tham số bổ sung khác (nếu có) để xác định truy vấn dữ liệu một cách cụ thể. Các tham số này thường được sử dụng để xác định một đối tượng hoặc một giá trị duy nhất liên quan đến truy vấn.

- Ví dụ, nếu bạn muốn truy vấn dữ liệu của một người dùng cụ thể với `userId` là 1, thì `queryKey` có thể được định nghĩa là `['user', 1]`. Trong đó, `'user'` là loại dữ liệu `"user"`, và 1 là `userId`.

- Tùy thuộc vào cách bạn định nghĩa truy vấn và cấu trúc dữ liệu của ứng dụng, số lượng và ý nghĩa của các tham số trong `queryKey` có thể khác nhau. Bạn có thể tuỳ chỉnh `queryKey` để phù hợp với nhu cầu của truy vấn dữ liệu của mình.

## ❌❌ Tham số đầu tiên trong `queryKey` có phải là nó tiếp nối với `router` trên `server` không. Ví dụ tôi có `localhost://blog/post`, trong link đó có `/post`, thì đó có phải là `type` của `queryKey` không ?

- Không, tham số đầu tiên trong `queryKey` không phải là tiếp nối với `router` trên `server`. Nó chỉ đơn giản là một chuỗi (string) đại diện cho loại dữ liệu bạn muốn truy vấn.

- Trong trường hợp của bạn, nếu bạn có một trang web `localhost://blog/post` và bạn muốn truy vấn dữ liệu về bài viết (`post`), bạn có thể sử dụng `'post'` làm tham số đầu tiên trong `queryKey` để xác định loại dữ liệu là bài viết.

- Ví dụ: `queryKey: ['post', ...]`

- Việc tiếp nối với `router` trên `server` thường được xử lý bên phía `server` và không liên quan trực tiếp đến `queryKey` trong React Query. `queryKey` chỉ đơn giản là một phần trong việc xác định truy vấn dữ liệu mà React Query sẽ quản lý và điều khiển.

## Vậy thì tham số đầu tiên trong `queryKey` phụ thuộc vào cái gì, nó đặt tên `type` cho tham số đầu tiên nó phụ thuộc vào đâu, hay là mình đặt tên gì cũng được ?

- Tham số đầu tiên trong `queryKey` không phụ thuộc vào bất kỳ yếu tố cụ thể nào và bạn có thể đặt tên cho nó theo ý muốn. Nó không có quy tắc cứng nhắc về cách đặt tên, và bạn có thể sử dụng bất kỳ chuỗi nào làm giá trị cho tham số đầu tiên.

- Tuy nhiên, để giữ cho tên tham số đầu tiên trong `queryKey` dễ hiểu và dễ quản lý, bạn có thể chọn các giá trị có liên quan đến loại dữ liệu bạn đang truy vấn. Ví dụ, nếu bạn đang truy vấn dữ liệu về bài viết, bạn có thể đặt tên tham số đầu tiên là `'post'`. Tuy nhiên, bạn cũng có thể sử dụng bất kỳ tên nào phù hợp với dự án của mình, ví dụ như `'data'`, `'item'`, `'resource'`, vv.

## Việc đặt tên như thế thì khi nó lưu trong `cache` thì nó có `key` là `post` có phải không ?

- Không, khi dữ liệu được lưu trong cache, không phải là tên của tham số đầu tiên trong `queryKey` được sử dụng làm `key` trong `cache`. Trong React Query, các key trong cache được quản lý tự động và được tạo ra dựa trên các tham số của `queryKey`, không phụ thuộc vào giá trị của các tham số đó.

- Khi bạn thực hiện một truy vấn và sử dụng `queryKey` để định danh nó, React Query sẽ tạo một key duy nhất cho truy vấn đó trong cache. Key này sẽ dựa trên các giá trị của các tham số trong `queryKey` và được tạo ra theo quy tắc của React Query.

- Vì vậy, trong ví dụ của bạn với `queryKey: ['post', id]`, dữ liệu được lưu trong cache sẽ không có key là `'post'`, mà sẽ có một key duy nhất được tạo ra bởi React Query dựa trên giá trị của `id` và quy tắc của nó.

## Vậy `'post'` trong tham số đầu tiên trong queryKey được đặt để làm gì ? Nó không có tác dụng gì hả ?

- Trong `queryKey`, tham số đầu tiên (trong trường hợp của bạn là `'post'`) không có tác dụng trực tiếp trong việc quản lý cache hoặc định danh truy vấn. Nó chỉ là một giá trị bổ sung mà bạn có thể sử dụng để phân loại các loại truy vấn hoặc nhận biết mục đích của truy vấn đó.

- Ví dụ, nếu bạn có nhiều loại truy vấn trong ứng dụng của mình như `'post'`, `'user'`, `'comment'`, thì sử dụng giá trị đầu tiên trong `queryKey` là một cách để phân loại các truy vấn và làm cho code dễ đọc hơn. Tuy nhiên, React Query không sử dụng giá trị này trong quá trình quản lý cache hay tạo key cho cache.

- Do đó, nếu bạn chỉ có một loại truy vấn duy nhất và không cần phân loại các truy vấn, bạn có thể sử dụng một mảng `queryKey` chỉ với một tham số, ví dụ như `[id]`, và bỏ qua giá trị đầu tiên.

## ❌❌ Đặt tên cho giá trị truy vấn là `'post'`, thì khi có một cái queryKey khác cũng có tham số đầu tiên là `'post'` lúc này 2 cái truy vấn cùng tên sẽ gọi lại cùng nhau đúng không ?

- Trong React Query, các truy vấn không chỉ phụ thuộc vào giá trị của tham số đầu tiên trong `queryKey` để xác định xem chúng có cùng một truy vấn hay không. Thay vào đó, React Query sử dụng cơ chế định danh truy vấn dựa trên toàn bộ `queryKey`.

- Khi bạn khởi tạo một truy vấn mới với một `queryKey` cụ thể, React Query sẽ tạo ra một key duy nhất cho truy vấn đó bằng cách kết hợp các giá trị trong `queryKey`. Do đó, ngay cả khi có hai `queryKey` với cùng giá trị `'post'` trong tham số đầu tiên, nhưng có các giá trị khác trong các tham số khác, chúng sẽ được xem là hai truy vấn riêng biệt và không gọi lại cùng nhau.

- Ví dụ:

```jsx
const queryKey1 = ['post', 1]
const queryKey2 = ['post', 2]

// Hai queryKey khác nhau, không gọi lại cùng nhau
queryClient.fetchQuery(queryKey1)
queryClient.fetchQuery(queryKey2)
```

- Do đó, khi đặt tên cho giá trị trong `queryKey`, bạn có thể sử dụng cùng một giá trị cho tham số đầu tiên nếu nó hợp lý với bản thiết kế của ứng dụng của bạn. Tuy nhiên, hãy chắc chắn rằng các giá trị khác trong `queryKey` khác nhau để các truy vấn không gọi lại nhau nhầm lẫn.

## ❌❌ Vậy thì tham số thứ 2 là `id`, nó là duy nhất. Mà nó dựa vào link `API` từ `server` để nó lấy dữ liệu hay sao ?

- Tham số thứ hai trong `queryKey` thường là một giá trị duy nhất như `ID`, và nó thường được sử dụng để định danh một mục dữ liệu cụ thể trong hệ thống hoặc API từ server.

- Khi bạn thực hiện một truy vấn với `queryKey` chứa một giá trị `ID`, ví dụ như `['post', 1]`, React Query sử dụng giá trị `ID` này để xác định dữ liệu cần truy vấn từ server. Cách xử lý chi tiết sẽ phụ thuộc vào cách bạn cấu hình truy vấn và tương tác với API của mình.

- Thông thường, bạn sẽ sử dụng giá trị `ID` để chỉ định một mục dữ liệu cụ thể, ví dụ như lấy thông tin một bài viết theo `ID`, hoặc lấy chi tiết một người dùng dựa trên `ID` của họ. Truyền giá trị `ID` này trong `queryKey` cho truy vấn sẽ giúp React Query nhận biết rõ rằng truy vấn đó tương ứng với một dữ liệu cụ thể và cần được cập nhật hoặc làm mới khi có thay đổi.

- Tuy nhiên, cách mà dữ liệu được truy vấn từ server dựa trên `queryKey` và giá trị `ID` sẽ phụ thuộc vào cách bạn triển khai API của mình. Bạn cần xác định và xử lý logic phù hợp trong hàm truy vấn (`queryFn`) để gửi yêu cầu đến API và lấy dữ liệu tương ứng với giá trị `ID` từ server.

## Bạn có thể tìm hiểu thêm về cách sử dụng `invalidateQueries` và các tùy chọn khác `invalidateQueries`:

- Tất nhiên! Cùng tìm hiểu thêm về cách sử dụng `invalidateQueries` và các tùy chọn trong React Query.

- Phương thức `invalidateQueries` được sử dụng để làm mới các truy vấn trong React Query. Nó có thể được sử dụng với các tùy chọn để kiểm soát cách truy vấn được làm mới.

- Cú pháp:

```jsx
queryClient.invalidateQueries(key, options)
```

- Trong đó:

  - `key` là key hoặc một mảng các key của các truy vấn cần làm mới.
  - `options` là một đối tượng (object) tùy chọn (không bắt buộc) để kiểm soát hành vi làm mới.

- Các tùy chọn phổ biến khi sử dụng `invalidateQueries` bao gồm:

  1. `exact`: Mặc định là `false`. Khi được đặt thành `true`, chỉ có các truy vấn có key chính xác trùng khớp với key mới sẽ được làm mới, các truy vấn con hoặc truy vấn khác không được làm mới.

  2. `refetchActive`: Mặc định là `false`. Khi được đặt thành `true`, các truy vấn đang trong quá trình `fetching` sẽ được hủy và làm mới.

  3. `refetchInactive`: Mặc định là `false`. Khi được đặt thành `true`, các truy vấn không hoạt động (`inactive`) sẽ được làm mới. Một truy vấn được coi là không hoạt động nếu không có listeners nào đang lắng nghe sự thay đổi trong nó.

  4. `throwOnError`: Mặc định là `false`. Khi được đặt thành `true`, nếu có lỗi xảy ra trong quá trình làm mới truy vấn, nó sẽ ném ra lỗi để được xử lý bên ngoài.

- Ví dụ sử dụng `invalidateQueries` với các tùy chọn:

```jsx
import { useQueryClient } from 'react-query';

const TodoList = () => {
  const queryClient = useQueryClient();

  const handleDeleteTodo = async (todoId) => {
    // Gọi API để xóa todo
    await deleteTodoAPI(todoId);

    // Làm mới truy vấn 'todos' và chỉ làm mới truy vấn chính xác
    queryClient.invalidateQueries('todos', {
      exact: true
    });
  };

  return (
    // ...
  );
};
```

- Trong ví dụ trên, chúng ta sử dụng `invalidateQueries` để làm mới truy vấn `'todos'` và chỉ làm mới truy vấn có key chính xác là `'todos'`. Các truy vấn con hoặc truy vấn khác không được làm mới.

- Đây là một ví dụ cơ bản về cách sử dụng `invalidateQueries` và các tùy chọn trong React Query. Bạn có thể tìm hiểu thêm về các tùy chọn khác và các khả năng linh hoạt khác của React Query trong tài liệu chính thức của nó.

## Hãy giải thích khái niệm về `invalidateQueries` và cách triển khai sử dụng nó trong code như thế nào ?

- Trong React Query, khái niệm `"invalidateQueries"` được sử dụng để làm mới (invalidate) các truy vấn đã được lưu trữ trong bộ nhớ cache. Khi một truy vấn được làm mới, React Query sẽ tự động gửi một yêu cầu mới để lấy dữ liệu mới nhất từ nguồn dữ liệu.

- Cách sử dụng `"invalidateQueries"` là thông qua phương thức `"invalidateQueries"` của đối tượng `queryClient`, mà bạn có thể lấy bằng cách sử dụng hook `"useQueryClient"` từ thư viện react-query. Ví dụ:

```jsx
import { useQueryClient } from 'react-query'

const TodoList = () => {
  const queryClient = useQueryClient()

  const handleDeleteTodo = async (todoId) => {
    // Gọi API để xóa todo

    // Làm mới truy vấn 'todos'
    queryClient.invalidateQueries('todos')
  }

  // ...
}
```

- Trong ví dụ trên, chúng ta sử dụng `"invalidateQueries"` để làm mới truy vấn có key là `'todos'`. Khi phương thức này được gọi, React Query sẽ tự động xóa truy vấn `'todos'` khỏi bộ nhớ cache và gửi một yêu cầu mới để lấy dữ liệu mới nhất từ nguồn dữ liệu.

- Ngoài ra, `"invalidateQueries"` cũng hỗ trợ các tùy chọn để kiểm soát cách làm mới truy vấn, như:

  - `exact`: Xác định liệu chỉ có truy vấn có key chính xác trùng khớp với key được chỉ định mới sẽ được làm mới hay không.
  - `refetchActive`: Xác định liệu các truy vấn đang trong quá trình `fetching` sẽ được hủy và làm mới hay không.
  - `refetchInactive`: Xác định liệu các truy vấn không hoạt động (inactive) sẽ được làm mới hay không.
  - `throwOnError`: Xác định liệu nếu có lỗi xảy ra trong quá trình làm mới truy vấn, có ném ra lỗi để được xử lý bên ngoài hay không.

- Các tùy chọn này có thể được truyền vào phương thức `"invalidateQueries"` để điều chỉnh hành vi làm mới truy vấn.

- `InvalidateQueries` là một công cụ mạnh mẽ trong React Query, cho phép làm mới các truy vấn một cách linh hoạt và dễ dàng khi cần thiết, đảm bảo rằng dữ liệu trong cache của chúng ta luôn được cập nhật và đồng bộ với nguồn dữ liệu.

## ❓❓ Còn khái niệm nào khác với khái niệm trên không ?

- Khái niệm khác liên quan đến `"invalidateQueries"` trong React Query là `"refetchQueries"`. `"refetchQueries"` cho phép làm mới một danh sách các truy vấn cụ thể sau khi một truy vấn hoặc `mutation` đã được thực hiện thành công.

- Khi sử dụng `"refetchQueries"`, bạn có thể chỉ định danh sách các truy vấn cần làm mới bằng cách sử dụng key của từng truy vấn. Khi một `mutation` hoặc một truy vấn thành công (với tùy chọn "onSuccess"), React Query sẽ tự động làm mới các truy vấn được chỉ định trong `"refetchQueries"`.

- Ví dụ:

```jsx
const createPost = async (newPost) => {
  // Gửi yêu cầu để tạo bài viết mới

  // Làm mới các truy vấn liên quan sau khi tạo bài viết thành công
  queryClient.refetchQueries(['posts', 'userPosts'])
}
```

- Trong ví dụ trên, sau khi tạo bài viết mới thành công, chúng ta sử dụng `"refetchQueries"` để làm mới hai truy vấn có keys là `'posts'` và `'userPosts'`. Các truy vấn này sẽ được gửi lại để lấy dữ liệu mới nhất từ nguồn dữ liệu.

- Qua đó, `"refetchQueries"` cung cấp một cách linh hoạt hơn để làm mới nhiều truy vấn cùng một lúc sau khi có sự thay đổi trong dữ liệu.

## ❌❌ Giải thích ý này trong đoạn trên: - Trong ví dụ trên, sau khi tạo bài viết mới thành công, chúng ta sử dụng `"refetchQueries"` để làm mới hai truy vấn có keys là `'posts'` và `'userPosts'`. Các truy vấn này sẽ được gửi lại để lấy dữ liệu mới nhất từ nguồn dữ liệu ? Có nghĩa là nó lấy dữ liệu mới nhất để nó lưu trong `cache` hay là nó `render` lên giao diện người dùng ?

- Khi sử dụng `"refetchQueries"` trong React Query, nó sẽ gửi lại các truy vấn được chỉ định trong danh sách `refetchQueries` để lấy dữ liệu mới nhất từ nguồn dữ liệu trên server. Sau đó, dữ liệu mới được nhận sẽ được lưu trong cache của React Query và có thể được sử dụng để render lại giao diện người dùng.

- Ví dụ, khi chúng ta tạo một bài viết mới thành công, chúng ta có thể sử dụng `"refetchQueries"` để gửi lại các truy vấn `'posts'` và `'userPosts'` để lấy danh sách bài viết mới nhất. Khi các truy vấn này thành công, dữ liệu mới sẽ được lưu trong cache của React Query. Sau đó, chúng ta có thể sử dụng dữ liệu mới này để cập nhật giao diện người dùng, hiển thị danh sách bài viết mới nhất và các bài viết của người dùng tương ứng.

- Tóm lại, `"refetchQueries"` giúp chúng ta làm mới các truy vấn và cập nhật dữ liệu mới nhất từ server, từ đó lưu vào cache và sử dụng để render lại giao diện người dùng.

## Theo trình tự là nó lưu vào trong cache của server trước rồi nó mới render lên giao diện người dùng phải không ?

- Không, trong trường hợp của React Query, dữ liệu không được lưu trực tiếp trong cache của `server`. React Query sử dụng một cache riêng để lưu trữ dữ liệu trên phía `client`, được quản lý bởi thư viện React Query.

- Khi một truy vấn được gửi từ React Query, dữ liệu trả về từ `server` sẽ được lưu trữ trong cache của React Query trên phía `client`. Sau đó, dữ liệu này có thể được truy xuất và sử dụng mà không cần gửi yêu cầu lại đến `server`. Khi có sự thay đổi trong dữ liệu hoặc khi chúng ta yêu cầu làm mới dữ liệu, React Query sẽ gửi yêu cầu tới `server` để lấy dữ liệu mới nhất và cập nhật lại cache.

- Sau khi dữ liệu đã được lưu trữ trong cache của React Query, chúng ta có thể sử dụng nó để render lại giao diện người dùng. Khi có thay đổi trong cache hoặc khi chúng ta gửi yêu cầu làm mới dữ liệu, React Query sẽ tự động cập nhật giao diện người dùng dựa trên dữ liệu mới trong cache mà không cần gửi yêu cầu mới đến `server`.

- Vì vậy, trong quá trình sử dụng React Query, dữ liệu được lưu trữ và quản lý trong cache của React Query trên phía `client` và dùng để render giao diện người dùng mà không tác động trực tiếp vào cache của `server`.

## ❓❓ `invalidateQueries` và `refetchQueries` điểm giống nhau của nó là gì ?

- Cả hai phương thức `invalidateQueries` và `refetchQueries` trong React Query đều liên quan đến việc cập nhật dữ liệu của các truy vấn.

- Điểm giống nhau của hai phương thức này là cả hai đều có thể được sử dụng để cập nhật dữ liệu của các truy vấn. Khi sử dụng cả `invalidateQueries` và `refetchQueries`, React Query sẽ gửi các yêu cầu mới để lấy dữ liệu mới nhất từ máy chủ và cập nhật lại kết quả truy vấn.

- Tuy nhiên, có một sự khác biệt quan trọng giữa hai phương thức này:

1. `invalidateQueries`: Phương thức này chỉ đánh dấu các truy vấn là không hợp lệ, nhưng không gửi yêu cầu lấy dữ liệu mới từ máy chủ. Nó thông báo cho React Query biết rằng dữ liệu của các truy vấn này đã không còn hợp lệ và cần được làm mới. React Query sẽ tự động gửi yêu cầu mới để lấy dữ liệu mới khi cần thiết, ví dụ như khi truy cập lại trang hoặc khi sử dụng các phương thức như `refetch` hoặc `useQueryClient`.

2. `refetchQueries`: Phương thức này gửi yêu cầu lấy dữ liệu mới từ máy chủ cho các truy vấn đã được chỉ định. Bằng cách sử dụng `refetchQueries`, bạn có thể tường minh yêu cầu React Query gửi yêu cầu mới và cập nhật dữ liệu của các truy vấn đã được chỉ định ngay lập tức.

- Tóm lại, điểm giống nhau của `invalidateQueries` và `refetchQueries` là cả hai đều liên quan đến việc cập nhật dữ liệu của các truy vấn, nhưng cách thức và quyền kiểm soát cập nhật dữ liệu của chúng có sự khác biệt.

## ❓❓ `invalidateQueries` và `refetchQueries` điểm khác nhau của nó là gì ?

- Điểm khác nhau chính giữa `invalidateQueries` và `refetchQueries` trong React Query là:

1. `invalidateQueries`: Phương thức `invalidateQueries` được sử dụng để đánh dấu các truy vấn là không hợp lệ. Khi bạn gọi phương thức này, React Query sẽ ghi nhận rằng dữ liệu của các truy vấn đã không còn hợp lệ và cần được làm mới. Tuy nhiên, phương thức này không gửi yêu cầu lấy dữ liệu mới từ máy chủ ngay lập tức. Thay vào đó, React Query sẽ tự động gửi yêu cầu lấy dữ liệu mới khi cần thiết, chẳng hạn khi truy cập lại trang hoặc khi sử dụng các phương thức như `refetch` hoặc `useQueryClient`.

2. `refetchQueries`: Phương thức `refetchQueries` được sử dụng để gửi yêu cầu lấy dữ liệu mới từ máy chủ cho các truy vấn đã được chỉ định. Khi bạn gọi phương thức này và chỉ định các truy vấn cần làm mới, React Query sẽ tức thì gửi yêu cầu mới và cập nhật dữ liệu của các truy vấn đó.

- Vậy điểm khác nhau chính là `invalidateQueries` chỉ đánh dấu truy vấn là không hợp lệ, trong khi `refetchQueries` gửi yêu cầu lấy dữ liệu mới ngay lập tức cho các truy vấn được chỉ định.

## ❓❓ Còn cái nào khác với khái niệm trên không ?

- Một khái niệm khác liên quan đến `"invalidateQueries"` trong React Query là `"resetQueries"`. `"resetQueries"` được sử dụng để đặt lại (reset) dữ liệu của một hay nhiều truy vấn về trạng thái ban đầu.

- Khi sử dụng `"resetQueries"`, bạn có thể chỉ định danh sách các truy vấn cần đặt lại bằng cách sử dụng key của từng truy vấn. Khi một hành động hoặc một sự kiện xảy ra và bạn muốn đặt lại dữ liệu các truy vấn để bắt đầu lại từ trạng thái ban đầu, bạn có thể sử dụng `"resetQueries"` để làm điều đó.

- Ví dụ:

```jsx
const handleLogout = async () => {
  // Thực hiện đăng xuất

  // Đặt lại dữ liệu các truy vấn liên quan về trạng thái ban đầu
  queryClient.resetQueries(['user', 'posts'])
}
```

- Trong ví dụ trên, khi người dùng thực hiện đăng xuất (Log out), chúng ta sử dụng `"resetQueries"` để đặt lại dữ liệu của hai truy vấn có keys là `'user'` và `'posts'`, để bắt đầu lại từ trạng thái ban đầu. Điều này có thể hữu ích khi cần đảm bảo rằng dữ liệu hiển thị sau khi đăng xuất là dữ liệu mới nhất và không bị lưu lại từ phiên đăng nhập trước.

- Tổng quan, `"resetQueries"` là một cách để đặt lại dữ liệu của các truy vấn về trạng thái ban đầu, trong khi `"invalidateQueries"` là một cách để đánh dấu các truy vấn là không hợp lệ và chuẩn bị cho việc làm mới chúng. Cả hai đều giúp quản lý và điều khiển dữ liệu trong React Query.

## Biết được cách sử dụng Invalidate Query (`invalidateQueries`) trong React Query:

- Trong React Query, `invalidateQueries` là một phương thức được cung cấp bởi `useQueryClient` để làm mới (invalidate) các truy vấn đã được lưu trong bộ nhớ cache. Khi chúng ta gọi phương thức này, React Query sẽ xóa kết quả truy vấn trong cache và kích hoạt lại việc truy vấn dữ liệu mới từ nguồn dữ liệu (ví dụ: từ API).

- Dưới đây là cách sử dụng phương thức `invalidateQueries` trong React Query:

1. Đầu tiên, chúng ta cần lấy instance của `queryClient` bằng cách sử dụng `useQueryClient` trong component:

```jsx
import { useQueryClient } from 'react-query'

const MyComponent = () => {
  const queryClient = useQueryClient()

  // ...
}
```

2. Sau đó, khi muốn làm mới một hoặc nhiều truy vấn, chúng ta gọi phương thức `invalidateQueries` trên `queryClient`:

```jsx
queryClient.invalidateQueries('todos')
```

- Trong ví dụ trên, chúng ta gọi `invalidateQueries('todos')` để làm mới các truy vấn có key là `'todos'`. Điều này sẽ xóa kết quả truy vấn trong cache và kích hoạt lại việc truy vấn dữ liệu mới cho các truy vấn có key là `'todos'`.

- Ngoài ra, chúng ta có thể truyền một mảng các key để làm mới nhiều truy vấn cùng một lúc:

```jsx
queryClient.invalidateQueries(['todos', 'user', 'posts'])
```

- Trong ví dụ trên, chúng ta làm mới các truy vấn có key là `'todos'`, `'user'` và `'posts'`. Tất cả các truy vấn này sẽ được xóa khỏi cache và truy vấn lại từ nguồn dữ liệu.

- `invalidateQueries` cũng hỗ trợ một số tùy chọn để điều chỉnh cách làm mới truy vấn, như `exact` để chỉ làm mới truy vấn chính xác bằng key hoặc `refetchActive` để làm mới các truy vấn đang được hoạt động. Để biết thêm chi tiết, bạn có thể tham khảo tài liệu chính thức của React Query.

## Hướng dẫn và ví dụ về việc sử dụng React Query, bao gồm cả việc sử dụng phương thức `invalidateQueries` ?

- Để sử dụng phương thức `invalidateQueries` trong React Query, bạn cần làm như sau:

1. Đầu tiên, đảm bảo rằng bạn đã cài đặt React Query và đã import các hàm cần thiết từ thư viện:

```jsx
import { useQueryClient } from 'react-query'
```

2. Trong component của bạn, sử dụng hook `useQueryClient` để lấy một instance của `QueryClient`:

```jsx
const queryClient = useQueryClient()
```

3. Bây giờ bạn có thể sử dụng phương thức `invalidateQueries` để làm mới các truy vấn trong `QueryClient`. Phương thức này nhận vào một key hoặc một mảng các key để chỉ định các truy vấn cần làm mới:

```jsx
queryClient.invalidateQueries('todos') // Làm mới truy vấn có key là 'todos'
queryClient.invalidateQueries(['user', userId]) // Làm mới truy vấn có key là ['user', userId]
queryClient.invalidateQueries() // Làm mới tất cả các truy vấn trong QueryClient
```

- Ví dụ về việc sử dụng `invalidateQueries`:

```jsx
import { useQuery, useQueryClient } from 'react-query'

const TodoList = () => {
  const queryClient = useQueryClient()

  const handleDeleteTodo = async (todoId) => {
    // Gọi API để xóa todo
    await deleteTodoAPI(todoId)

    // Làm mới truy vấn 'todos' sau khi xóa
    queryClient.invalidateQueries('todos')
  }

  return (
    <div>
      {/* Hiển thị danh sách todo */}
      {todos.map((todo) => (
        <div key={todo.id}>
          <span>{todo.title}</span>
          <button onClick={() => handleDeleteTodo(todo.id)}>Xóa</button>
        </div>
      ))}
    </div>
  )
}
```

- Trong ví dụ trên, khi người dùng nhấn vào nút "Xóa" để xóa một todo, chúng ta gọi API để thực hiện xóa todo đó. Sau khi xóa thành công, chúng ta sử dụng `invalidateQueries` để làm mới truy vấn 'todos', từ đó đảm bảo rằng danh sách todos được cập nhật mới nhất.

## Đây là một ví dụ khác về invalidateQueries trong react query:

-

## Cập nhật data của query thông qua mutation trong React Query:

## Hiểu cách sử dụng tính năng prefetching của React Query:

## Cập nhật data query thông qua setQueryData trong React Query:

## refetch lại query thông qua cơ chế invalidate trong React Query:

## Sử dụng tính năng prefetching query trong React Query:

## Đây là Docs của Được Dev:

Ở video lần trước nếu anh em để ý thì mình có một bug nho nhỏ trong phần Student Info đó là không hiển thị đúng gender, video này mình sẽ fix luôn.

💓Kiến thức các bạn sẽ được học trong video này:

🎉 Biết được cách sử dụng Invalidate Query
🎉 Cập nhật data của query thông qua mutation
🎉 Hiểu cách sử dụng tính năng prefetching của React Query

🕰️Nội dung chính

00:00 - Cập nhật data query thông qua setQueryData
05:38 - refetch lại query thông qua cơ chế invalidate
12:14 - Sư dụng tính năng prefetching query

![SWR trong React Query](image-1.png)
